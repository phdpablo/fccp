<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Interativo - Modelo de Baumol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-blue: #0D232C;
            --vibrant-orange: #F18C22;
            --light-teal: #87CBCC;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: var(--dark-blue);
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            border: 1px solid #e2e8f0;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 350px;
        }
        .table-container {
            max-height: 350px;
            overflow-y: auto;
        }
        .highlight {
            background-color: #fff2e4; /* Cor laranja bem claro para destaque */
            font-weight: 700;
        }
        .input-focus:focus {
            border-color: var(--vibrant-orange);
            --tw-ring-color: var(--vibrant-orange);
        }
        .header-title {
            color: var(--dark-blue);
        }
    </style>
</head>
<body class="antialiased">

    <main class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold header-title mb-2">Simulador Interativo do Modelo de Baumol</h1>
            <p class="text-md text-slate-600 max-w-3xl mx-auto">Ajuste os parâmetros para encontrar o Lote Econômico de Caixa (LEC) e visualize o impacto nos custos e no fluxo de caixa ao longo do tempo.</p>
        </header>

        <div class="grid lg:grid-cols-12 gap-8">
            <!-- Painel de Controle e Tabela -->
            <div class="lg:col-span-5 space-y-8">
                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4 header-title">Painel de Controle</h2>
                    <div class="bg-slate-50 p-3 rounded-md text-center my-4 border">
                        <p>\( C = \sqrt{\frac{2 \times b \times T}{i}} \)</p>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="total-cash-need" class="block text-sm font-medium text-slate-700">Necessidade Mensal de Caixa (T)</label>
                            <input type="number" id="total-cash-need" class="input-focus mt-1 block w-full rounded-md border-slate-300 shadow-sm" value="120000">
                        </div>
                        <div>
                            <label for="transaction-cost" class="block text-sm font-medium text-slate-700">Custo por Transação (b)</label>
                            <input type="number" id="transaction-cost" class="input-focus mt-1 block w-full rounded-md border-slate-300 shadow-sm" value="50">
                        </div>
                        <div>
                            <label for="interest-rate" class="block text-sm font-medium text-slate-700">Taxa de Juros Mensal (%) (i)</label>
                            <input type="number" id="interest-rate" class="input-focus mt-1 block w-full rounded-md border-slate-300 shadow-sm" value="1">
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4 header-title">Resultados da Simulação</h2>
                     <div class="text-center p-4 rounded-lg border mb-4" style="background-color: #e3f8f8; border-color: var(--light-teal);">
                        <h3 class="font-semibold">Lote Econômico de Caixa (LEC / C*)</h3>
                        <p id="optimal-cash-result" class="font-bold text-2xl" style="color: var(--dark-blue);">R$ 0,00</p>
                    </div>
                    <div class="table-container">
                        <table class="w-full text-sm text-left">
                            <thead class="sticky top-0 bg-slate-100">
                                <tr>
                                    <th class="p-2">VEC (C)</th>
                                    <th class="p-2">C. Transação</th>
                                    <th class="p-2">C. Oportunidade</th>
                                    <th class="p-2">C. Total</th>
                                </tr>
                            </thead>
                            <tbody id="results-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gráficos -->
            <div class="lg:col-span-7 space-y-8">
                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4 header-title">Gráfico de Custos da Gestão de Caixa</h2>
                    <div class="chart-container">
                        <canvas id="costsChart"></canvas>
                    </div>
                </div>
                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4 header-title">Gráfico de Movimentação do Caixa (Dente de Serra)</h2>
                    <div class="chart-container">
                        <canvas id="sawtoothChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center py-6 mt-12 border-t border-gray-200">
        <p class="text-sm text-gray-500">
            © 2025 <a href="https://fccp.phdpablo.com" target="_blank" rel="noopener noreferrer" class="font-semibold transition hover:underline" style="color: var(--vibrant-orange);">fccp.phdpablo.com</a>. Todos os direitos reservados.
        </p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            const totalCashNeedInput = document.getElementById('total-cash-need');
            const transactionCostInput = document.getElementById('transaction-cost');
            const interestRateInput = document.getElementById('interest-rate');
            
            const optimalCashResultEl = document.getElementById('optimal-cash-result');
            const tableBody = document.getElementById('results-table-body');
            
            const costsCtx = document.getElementById('costsChart').getContext('2d');
            const sawtoothCtx = document.getElementById('sawtoothChart').getContext('2d');
            let costsChart, sawtoothChart;
            
            const colors = {
                darkBlue: '#0D232C',
                vibrantOrange: '#F18C22',
                lightTeal: '#87CBCC',
            };

            function initializeCharts() {
                if (costsChart) costsChart.destroy();
                if (sawtoothChart) sawtoothChart.destroy();

                costsChart = new Chart(costsCtx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'Valor de Cada Conversão (VEC / C)' } },
                            y: { title: { display: true, text: 'Custo (R$)' } }
                        },
                        plugins: { tooltip: { mode: 'index', intersect: false } }
                    }
                });

                sawtoothChart = new Chart(sawtoothCtx, {
                    type: 'line',
                    data: { datasets: [] },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: {
                            y: { title: { display: true, text: 'Saldo de Caixa (R$)' } },
                            x: { type: 'linear', min: 0, max: 30, title: { display: true, text: 'Tempo (Dias)' } }
                        },
                        plugins: { legend: { display: true, position: 'top' } }
                    }
                });
            }

            function runSimulation() {
                const T = parseFloat(totalCashNeedInput.value) || 0;
                const b = parseFloat(transactionCostInput.value) || 0;
                const i = (parseFloat(interestRateInput.value) || 0) / 100;

                if (T <= 0 || b <= 0 || i <= 0) return;

                const optimalC = Math.sqrt((2 * b * T) / i);
                optimalCashResultEl.textContent = formatCurrency(optimalC);

                // 1. Geração de dados para Tabela e Gráfico de Custos
                const simulationRange = [];
                const step = optimalC / 10 > 0 ? optimalC / 10 : 1;
                for (let c = step; c <= optimalC * 2; c += step) {
                    simulationRange.push(c);
                }

                let minTotalCost = Infinity;
                let bestC = 0;
                
                const tableData = simulationRange.map(c => {
                    const transactionCost = (T / c) * b;
                    const opportunityCost = (c / 2) * i;
                    const totalCost = transactionCost + opportunityCost;

                    if (totalCost < minTotalCost) {
                        minTotalCost = totalCost;
                        bestC = c;
                    }
                    
                    return { c, transactionCost, opportunityCost, totalCost };
                });

                tableBody.innerHTML = tableData.map(row => `
                    <tr class="${Math.abs(row.c - bestC) < step / 2 ? 'highlight' : ''}">
                        <td class="p-2">${formatCurrency(row.c)}</td>
                        <td class="p-2">${formatCurrency(row.transactionCost)}</td>
                        <td class="p-2">${formatCurrency(row.opportunityCost)}</td>
                        <td class="p-2 font-semibold">${formatCurrency(row.totalCost)}</td>
                    </tr>
                `).join('');

                costsChart.data.labels = tableData.map(d => d.c.toFixed(0));
                costsChart.data.datasets = [
                    { label: 'C. Transação', data: tableData.map(d => d.transactionCost), borderColor: colors.lightTeal, backgroundColor: colors.lightTeal + '20', fill: false, tension: 0.1 },
                    { label: 'C. Oportunidade', data: tableData.map(d => d.opportunityCost), borderColor: colors.vibrantOrange, backgroundColor: colors.vibrantOrange + '20', fill: false, tension: 0.1 },
                    { label: 'C. Total', data: tableData.map(d => d.totalCost), borderColor: colors.darkBlue, backgroundColor: colors.darkBlue + '20', fill: false, tension: 0.1, borderWidth: 3 }
                ];
                costsChart.update();

                // 2. Geração de dados para o Gráfico Dente de Serra
                const dailyUsage = T / 30;
                let cashBalance = optimalC;
                const sawtoothData = [{x: 0, y: optimalC}];
                let currentDay = 0;

                if (dailyUsage > 0) {
                    while(currentDay < 30) {
                        const daysToDeplete = cashBalance / dailyUsage;
                        currentDay += daysToDeplete;
                        
                        if (currentDay > 30) {
                            const remainingDays = 30 - (currentDay - daysToDeplete);
                            const finalBalance = cashBalance - (remainingDays * dailyUsage);
                            sawtoothData.push({x: 30, y: finalBalance});
                            break;
                        }
                        
                        sawtoothData.push({x: currentDay, y: 0});
                        
                        if (currentDay < 30) {
                            cashBalance = optimalC;
                            sawtoothData.push({x: currentDay, y: cashBalance});
                        }
                    }
                }
                
                sawtoothChart.data.datasets = [
                    {
                        label: 'Saldo de Caixa',
                        data: sawtoothData,
                        borderColor: colors.darkBlue,
                        tension: 0,
                        fill: false,
                    },
                    {
                        label: 'Saldo Ótimo (C)',
                        data: [{x:0, y:optimalC}, {x:30, y:optimalC}],
                        borderColor: colors.vibrantOrange,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        type: 'line'
                    }
                ];
                sawtoothChart.update();
            }

            [totalCashNeedInput, transactionCostInput, interestRateInput].forEach(input => {
                input.addEventListener('input', runSimulation);
            });

            initializeCharts();
            runSimulation();
        });
    </script>
</body>
</html>